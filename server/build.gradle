apply plugin: 'java'


repositories {
    flatDir {
        dirs 'dist/libs'
    }
}

dependencies {
    compile name: 'slf4j-simple-1.7.9'
    compile name: 'slf4j-api-1.7.9'
    compile name: 'netty-all-5.0.0.Alpha1'
    compile name: 'parallelcolt-0.9.4'
    compile name: 'javolution-5.5.1'
    compile name: 'javassist'
    compile name: 'HikariCP-java6-2.2.5'
    runtime name: 'mysql-connector-java'
}

task jarGame(type: Jar) {
    baseName = "gameserver"
    from(sourceSets.main.output) {
        include '**'
        exclude 'com/a4server/loginserver/**'
    }

    manifest {
        attributes 'Implementation-Title': 'Game server',
                'Main-Class': 'com.a4server.gameserver.GameServer'
    }
}

task jarLogin(type: Jar) {
    baseName = "loginserver"
    from(sourceSets.main.output) {
        include '**'
        exclude 'com/a4server/gameserver/**'
    }

    manifest {
        attributes 'Implementation-Title': 'Login server',
                'Main-Class': 'com.a4server.loginserver.LoginServer'
    }
}

build.doLast {
    tasks.afterBuild.execute()
    tasks.jarGame.execute()
    tasks.jarLogin.execute()
    tasks.makeDist.execute()
}

task afterBuild(dependsOn: build) {
    def distDir = new File('build/dist')
    distDir.mkdirs()
}

task makeDist(type: Sync) {
    dependsOn afterBuild

    from 'dist/'
    into 'build/dist'

    into ('game') {
        from ('build/libs/') {
            include 'gameserver.jar'
            
        }
    }
    into ('login') {
        from ('build/libs/') {
            include 'loginserver.jar'

        }
    }

    into ('game/config') {
        from 'config'
    }
    into ('login/config') {
        from 'config'
    }
}


task "rg" (type:JavaExec, dependsOn:[classes]) {
    main = 'com.a4server.gameserver.GameServer'
    classpath = sourceSets.main.runtimeClasspath
}

task "rl" (type:JavaExec, dependsOn:[classes]) {
    main = 'com.a4server.loginserver.LoginServer'
    classpath = sourceSets.main.runtimeClasspath
}